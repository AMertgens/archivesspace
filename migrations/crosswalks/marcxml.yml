# Notes:
# 'procedure' may be better described as 'override'
#   it is a pre value-assigment hook, basically
inherit: marcxml_subjects_and_agents 

source:
  format: "xml"
  schema: "http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd"
entities:
  resource: 
    xpath: ["//record"]
    properties:
      id_0:
        xpath: ["child::datafield[@tag='852']/subfield[@code='c']"]
        procedure: "|val| val.match(/^.*\\./) ? val.split('.')[0] : val"
      
      id_1:
        xpath: ["child::datafield[@tag='852']/subfield[@code='c']"]
        procedure: "|val| val.match(/^.*\\..*/) ? val.split('.')[1] : nil"
        
      id_2:
        xpath: ["child::datafield[@tag='852']/subfield[@code='c']"]
        procedure: "|val| val.match(/^.*\\..*\\..*/) ? val.split('.')[2] : nil"

      language:
        xpath: ["child::datafield[@tag='040']/subfield[@code='b']"]

      title:
        xpath: ["child::datafield[@tag='245']/subfield[@code='a']"]
        
      level:
        default: collection

      extents:
        axis: descendant
      
      notes:
        axis: descendant
        
      # TODO: untangle
      linked_agents:
        xpath: ["descendant::datafield[@tag='600']", "descendant::datafield[@tag='610']", "descendant::datafield[@tag='700']", "descendant::datafield[@tag='710']"]
        procedure: "|val| val.respond_to?(:uri) ? {'role' => Proc.new {|rol| if rol && rol.match(/\\((cre|dnr)\\)/); 'creator'; elsif rol && rol.match(/source/); 'source'; else; 'subject'; end}.call(val._role), 'ref' => val.uri} : nil"
        
      subjects:
        axis: descendant
  
  extent:
    xpath: ["//datafield[@tag='300']"]
    properties:
      portion:
        default: whole
        
      number:
        xpath: ["child::subfield[@code='a']"]
        default: '1'
        procedure: "|val| val.gsub(/[^0-9\\.]/, '')"
        
      extent_type:
        xpath: ["child::subfield[@code='a']"]
        default: reels
        procedure: "|val| val.gsub(/^[0-9\\.\\s]+/, '')"
        # procedure: "|val| val.downcase.include?('linear feet') ? 'linear_feet' : nil"
        
  arrangement_note:
    record_type: note_multipart
    xpath: ["//datafield[@tag='351']"]
    properties: 
      label:
        xpath: ["child::subfield[@code='b']"]
        default: This is not a note label
  
  
      content:
        xpath: ["self"]
  
      type:
        default: Arrangement
  
  general_note:
    record_type: note_multipart
    xpath: ["//datafield[@tag='500']", "//datafield[@tag='535']", "//datafield[@tag='540']", "//datafield[@tag='546']"]
    properties: 
      label:
        xpath: ["child::subfield[@code='a']"]
        default: This is not a note label
        procedure: "|val| val.sub(/:.*/, '')"
  
      content:
        xpath: ["self"]
  
      type:
        default: General
  
  access_restriction_type:
    record_type: note_multipart
    xpath: ["//datafield[@tag='506']"]
    properties:
      label:
        xpath: ["child::subfield[@code='a]"]
        default: This is not a note label
      
      content:
        xpath: ["self"]
  
      type:
        default: Conditions Governing Access
        
  scope_content_note:
    record_type: note_multipart
    xpath: ["//datafield[@tag='520']"]
    properties:
      label:
        default: This is not a note label
      
      content:
        xpath: ["self"]
        
      type:
        default: Scope and Contents
  
  preferred_citation:
    record_type: note_multipart
    xpath: ["//datafield[@tag='524']"]
    properties:
      label:
        default: This is not a note label
        
      content:
        xpath: ["self"]
        
      type:
        default: Preferred Citation
        
  acqinfo:
    record_type: note_multipart
    xpath: ["//datafield[@tag='541']"]
    properties:
      label:
        default: This is not a note label
        
      content:
        xpath: ["self"]
        
      type:
        default: Immediate Source of Acquisition
        
  relatedmaterial:
    record_type: note_multipart
    xpath: ["//datafield[@tag='544']"]
    properties:
      label:
        default: This is not a note label
  
      content:
        xpath: ["self"]
  
      type:
        default: Related Archival Materials
  
  bioghist:
    record_type: note_multipart
    xpath: ["//datafield[@tag='545']"]
    properties:
      label:
        default: This is not a note label
  
      content:
        xpath: ["self"]
  
      type:
        default: Biographical / Historical        
    
  otherfindaid:
    record_type: note_multipart
    xpath: ["//datafield[@tag='555']"]
    properties:
      label:
        xpath: ["subfield[@code='a']"]
        default: This is not a note label
  
      content:
        xpath: ["subfield[@code='u']"]
  
      type:
        default: Other Finding Aids
        
  custodhist:
    record_type: note_multipart
    xpath: ["//datafield[@tag='561']"]
    properties:
      label:
        default: This is not a note label
  
      content:
        xpath: ["self"]
  
      type:
        default: Custodial History
        
  appraisal:
    record_type: note_multipart
    xpath: ["//datafield[@tag='583']"]
    properties:
      label:
        default: This is not a note label
  
      content:
        xpath: ["self"]
  
      type:
        default: Appraisal
        
  accruals:
    record_type: note_multipart
    xpath: ["//datafield[@tag='584']"]
    properties:
      label:
        default: This is not a note label
  
      content:
        xpath: ["self"]
  
      type:
        default: Accruals
 

