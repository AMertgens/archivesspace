REPORTS IN ASPACE
-------------


ArchivesSpace now supports Jasper Reports for generating reports, in addition to the standard reports module. This includes both reports using a JSON datasource from the API or a direct database access using the JDBC connection.

Most users will probably want to use the JDBC report. However, the JSON report is a good option if 1) you don't have direct access to your database to author the report or 2) have a rather simple report.

To add a Jasper Report to ArchivesSpace, you'll first need to make the Japer jrxml files using iReport or Jasper Studio.
NOTE:  Some jrxml files generated by iReport and Jasper Studio put language="groovy" in the XML root. ASpace doesn't use Groovy, so remove this declaration from the XML, otherwise ASpace will not launch correctly.

Adding these to ArchivesSpace is rather straight-forward:

1) Create a subdirectory in ASPACE_BASE/reports with the name of your report. 

This should follow a camelcase format ( e.g. "CamelCaseFormat", no spaces/underscores with the first letter of each word capitalized ) and end with word "Report".
For example, "reports/MyLocationsReport"  

2) Put your reports jrxml files in its reports subdirectory. 

Make the main report have the same name as your directory ( e.g. MyLocationsReport.jrxml ). Subreports can be named whatever you like, as their filesnames are referred in the primary report xml file.
However, the typical convention is to prefix subreports with "sub_". 


3) Add your report's configuration file to its reports subdirectory. 
You will also need to put a configuration file ( named "report_config.yml" ) that has value pairs for setting up the report in the application.
Generally,  this report_config.yml file will look like this:

```yaml
report_type: jdbc
uri_suffix: my_locations 
description: "A list of subject records" 
```

This defines the report type ( jdbc or json ), the uri_suffix ( the REST endpoint for the report ), and a description to be added in the UI. 
By convention, the uri_suffix should be a generalised name of the report. This must be unique. 

4) Restart the application. You should now see your reports in the Staff UI's report interface.



Advanced Reports
-------------

If you want to add additional methods or make your report more complicated, you can do this via adding a plugin. 
This is especially useful for JSON reports, since the require a bit more code to run than the JDBC report ( which is mostly contained in the 
Jasper jrxml file ) 

These enhanced reports should go into the plugins/local/backend/model/reports folder ( be sure that you have the local plugin enabled
in your config.rb ). The convention is that the report class name is a camelcased version of your uri_suffix with "Report" appended.
Therefore, a report with a uri_suffix = "my_locations", would have a class called MyLocationsReport. So to add methods to this report, the
overrides would go into plugins/local/backend/model/reports/my_locations_report.rb.

An example override of a JSONReport ill look like this:

```ruby
class MyLocationsReport < JSONReport

	

	# this is the query that is pull from the DB and transformed into JSON for the JSON report. 
	def query
          locations = db[:location].select(:building, :title, :floor, :room, :area, :barcode, :classification, :id ).all
          results = { :locations => locations }
          return results
	end

end
```

Combining your Jasper reports with a plugin can make you reports very powerful.


Questions? Please contact us and let us know. 



Report Assets
-------------

## Using a custom font for PDF reports

ArchivesSpace uses the public domain font `Deja Vu` when rendering PDF reports.  While this font offers a good
coverage of Unicode characters, you may wish to use your own licenced font for a greater coverage.

To configure your own font:

1. Under your `archivesspace` directory add your `ttf` font to the `reports/static/fonts` directory

2. In the `config/config.rb`, modify the following configuration settings to refer to your new font:

        AppConfig[:report_pdf_font_paths] = proc { ["#{AppConfig[:backend_url]}/reports/static/fonts/myfont.ttf"] }
        AppConfig[:report_pdf_font_family] = "My Font"

3. Restart your application for the new configuration settings to apply.


