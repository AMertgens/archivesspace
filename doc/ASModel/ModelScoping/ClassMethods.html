<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: ASModel::ModelScoping::ClassMethods
  
    &mdash; Documentation by YARD 0.8.3
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../alpha_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../ASModel.html" title="ASModel (module)">ASModel</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../ModelScoping.html" title="ASModel::ModelScoping (module)">ModelScoping</a></span></span>
     &raquo; 
    <span class="title">ClassMethods</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
    <a class="full_list_link" id="schema_list_link"
        href="../../schema_list.html">
      Schema List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: ASModel::ModelScoping::ClassMethods
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">backend/app/model/ASModel.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#active_repository-instance_method" title="#active_repository (instance method)">- (Object) <strong>active_repository</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#enable_suppression-instance_method" title="#enable_suppression (instance method)">- (Object) <strong>enable_suppression</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#enforce_suppression%3F-instance_method" title="#enforce_suppression? (instance method)">- (Boolean) <strong>enforce_suppression?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#model_scope-instance_method" title="#model_scope (instance method)">- (Object) <strong>model_scope</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_reference-instance_method" title="#parse_reference (instance method)">- (Object) <strong>parse_reference</strong>(uri, opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Like JSONModel.parse_reference, but enforce repository restrictions.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_model_scope-instance_method" title="#set_model_scope (instance method)">- (Object) <strong>set_model_scope</strong>(value) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#suppressible%3F-instance_method" title="#suppressible? (instance method)">- (Boolean) <strong>suppressible?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#uri_for-instance_method" title="#uri_for (instance method)">- (Object) <strong>uri_for</strong>(jsonmodel, id, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="active_repository-instance_method">
  
    - (<tt>Object</tt>) <strong>active_repository</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


606
607
608
609
610
611
612
613
614</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/model/ASModel.rb', line 606</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_active_repository identifier id'>active_repository</span>
  <span class='rubyid_repo identifier id'>repo</span> <span class='assign token'>=</span> <span class='rubyid_RequestContext constant id'>RequestContext</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='symbol val'>:repo_id</span><span class='rparen token'>)</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_model_scope identifier id'>model_scope</span> <span class='eq op'>==</span> <span class='symbol val'>:repository</span> <span class='rubyid_and and kw'>and</span> <span class='rubyid_repo identifier id'>repo</span><span class='dot token'>.</span><span class='rubyid_nil? fid id'>nil?</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='string val'>&quot;Missing repo_id for request!&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_repo identifier id'>repo</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="enable_suppression-instance_method">
  
    - (<tt>Object</tt>) <strong>enable_suppression</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


519
520
521</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/model/ASModel.rb', line 519</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_enable_suppression identifier id'>enable_suppression</span>
  <span class='rubyid_@suppressible ivar id'>@suppressible</span> <span class='assign token'>=</span> <span class='rubyid_true true kw'>true</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="enforce_suppression?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>enforce_suppression?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


524
525
526</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/model/ASModel.rb', line 524</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_enforce_suppression? fid id'>enforce_suppression?</span>
  <span class='rubyid_RequestContext constant id'>RequestContext</span><span class='dot token'>.</span><span class='rubyid_get identifier id'>get</span><span class='lparen token'>(</span><span class='symbol val'>:enforce_suppression</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="model_scope-instance_method">
  
    - (<tt>Object</tt>) <strong>model_scope</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


583
584
585
586</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/model/ASModel.rb', line 583</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_model_scope identifier id'>model_scope</span>
  <span class='rubyid_@model_scope ivar id'>@model_scope</span> <span class='rubyid_or or kw'>or</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='dstring node'>&quot;set_model_scope definition missing for model #{self}&quot;</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_reference-instance_method">
  
    - (<tt>Object</tt>) <strong>parse_reference</strong>(uri, opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Like JSONModel.parse_reference, but enforce repository restrictions</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


590
591
592
593
594
595
596
597
598
599
600
601
602
603</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/model/ASModel.rb', line 590</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_parse_reference identifier id'>parse_reference</span><span class='lparen token'>(</span><span class='rubyid_uri identifier id'>uri</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span><span class='rparen token'>)</span>
  <span class='rubyid_ref identifier id'>ref</span> <span class='assign token'>=</span> <span class='rubyid_JSONModel constant id'>JSONModel</span><span class='dot token'>.</span><span class='rubyid_parse_reference identifier id'>parse_reference</span><span class='lparen token'>(</span><span class='rubyid_uri identifier id'>uri</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span><span class='rparen token'>)</span>

  <span class='comment val'># If the current model is repository scoped, and the reference is a</span>
  <span class='comment val'># repository-scoped URI, make sure they're talking about the same</span>
  <span class='comment val'># repository.</span>
  <span class='rubyid_if if kw'>if</span> <span class='rubyid_ref identifier id'>ref</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_model_scope identifier id'>model_scope</span> <span class='eq op'>==</span> <span class='symbol val'>:repository</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_uri identifier id'>uri</span><span class='dot token'>.</span><span class='rubyid_start_with? fid id'>start_with?</span><span class='lparen token'>(</span><span class='string val'>&quot;/repositories/&quot;</span><span class='rparen token'>)</span>
    <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='rubyid_uri identifier id'>uri</span><span class='dot token'>.</span><span class='rubyid_start_with? fid id'>start_with?</span><span class='lparen token'>(</span><span class='dstring node'>&quot;/repositories/#{active_repository}/&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_raise identifier id'>raise</span> <span class='dstring node'>&quot;Invalid URI reference for this repo: '#{uri}'&quot;</span>
    <span class='rubyid_end end kw'>end</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_ref identifier id'>ref</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_model_scope-instance_method">
  
    - (<tt>Object</tt>) <strong>set_model_scope</strong>(value) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/model/ASModel.rb', line 533</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_set_model_scope identifier id'>set_model_scope</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='rubyid_if if kw'>if</span> <span class='notop op'>!</span><span class='lbrack token'>[</span><span class='symbol val'>:repository</span><span class='comma token'>,</span> <span class='symbol val'>:global</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='rubyid_include? fid id'>include?</span><span class='lparen token'>(</span><span class='rubyid_value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='rubyid_raise identifier id'>raise</span> <span class='dstring node'>&quot;Failure for #{self}: Model scope must be set as :repository or :global&quot;</span>
  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_if if kw'>if</span> <span class='rubyid_value identifier id'>value</span> <span class='eq op'>==</span> <span class='symbol val'>:repository</span>
    <span class='rubyid_model identifier id'>model</span> <span class='assign token'>=</span> <span class='rubyid_self self kw'>self</span>
    <span class='rubyid_orig_ds identifier id'>orig_ds</span> <span class='assign token'>=</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_dataset identifier id'>dataset</span><span class='dot token'>.</span><span class='rubyid_clone identifier id'>clone</span>

    <span class='comment val'># Provide a new '.this_repo' method on this model class that only</span>
    <span class='comment val'># returns records that belong to the current repository.</span>
    <span class='rubyid_def_dataset_method identifier id'>def_dataset_method</span><span class='lparen token'>(</span><span class='symbol val'>:this_repo</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
      <span class='rubyid_filter identifier id'>filter</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:repo_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_model identifier id'>model</span><span class='dot token'>.</span><span class='rubyid_active_repository identifier id'>active_repository</span><span class='rbrace token'>}</span>

      <span class='rubyid_if if kw'>if</span> <span class='rubyid_model identifier id'>model</span><span class='dot token'>.</span><span class='rubyid_suppressible? fid id'>suppressible?</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_model identifier id'>model</span><span class='dot token'>.</span><span class='rubyid_enforce_suppression? fid id'>enforce_suppression?</span>
        <span class='rubyid_filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='symbol val'>:suppressed</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_orig_ds identifier id'>orig_ds</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='rubyid_filter identifier id'>filter</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>


    <span class='comment val'># And another that will return records from any repository</span>
    <span class='rubyid_def_dataset_method identifier id'>def_dataset_method</span><span class='lparen token'>(</span><span class='symbol val'>:any_repo</span><span class='rparen token'>)</span> <span class='rubyid_do do kw'>do</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_model identifier id'>model</span><span class='dot token'>.</span><span class='rubyid_suppressible? fid id'>suppressible?</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_model identifier id'>model</span><span class='dot token'>.</span><span class='rubyid_enforce_suppression? fid id'>enforce_suppression?</span>
        <span class='rubyid_orig_ds identifier id'>orig_ds</span><span class='dot token'>.</span><span class='rubyid_filter identifier id'>filter</span><span class='lparen token'>(</span><span class='symbol val'>:suppressed</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
      <span class='rubyid_else else kw'>else</span>
        <span class='rubyid_orig_ds identifier id'>orig_ds</span>
      <span class='rubyid_end end kw'>end</span>
    <span class='rubyid_end end kw'>end</span>


    <span class='comment val'># Replace the default row_proc with one that fetches the request row,</span>
    <span class='comment val'># but blows up if that row isn't from the currently active repository.</span>
    <span class='rubyid_orig_row_proc identifier id'>orig_row_proc</span> <span class='assign token'>=</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_dataset identifier id'>dataset</span><span class='dot token'>.</span><span class='rubyid_row_proc identifier id'>row_proc</span>
    <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_dataset identifier id'>dataset</span><span class='dot token'>.</span><span class='rubyid_row_proc identifier id'>row_proc</span> <span class='assign token'>=</span> <span class='rubyid_proc identifier id'>proc</span> <span class='rubyid_do do kw'>do</span> <span class='bitor op'>|</span><span class='rubyid_row identifier id'>row</span><span class='bitor op'>|</span>
      <span class='rubyid_if if kw'>if</span> <span class='rubyid_row identifier id'>row</span><span class='dot token'>.</span><span class='rubyid_has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='symbol val'>:repo_id</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='rubyid_row identifier id'>row</span><span class='lbrack token'>[</span><span class='symbol val'>:repo_id</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='rubyid_model identifier id'>model</span><span class='dot token'>.</span><span class='rubyid_active_repository identifier id'>active_repository</span>
        <span class='rubyid_raise identifier id'>raise</span> <span class='lparen token'>(</span><span class='dstring node'>&quot;ASSERTION FAILED: #{row.inspect} has a repo_id of &quot;</span> <span class='plus op'>+</span>
               <span class='dstring node'>&quot;#{row[:repo_id]} but the active repository is #{model.active_repository}&quot;</span><span class='rparen token'>)</span>
      <span class='rubyid_end end kw'>end</span>

      <span class='rubyid_orig_row_proc identifier id'>orig_row_proc</span><span class='dot token'>.</span><span class='rubyid_call identifier id'>call</span><span class='lparen token'>(</span><span class='rubyid_row identifier id'>row</span><span class='rparen token'>)</span>
    <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_end end kw'>end</span>

  <span class='rubyid_@model_scope ivar id'>@model_scope</span> <span class='assign token'>=</span> <span class='rubyid_value identifier id'>value</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="suppressible?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>suppressible?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


529
530
531</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/model/ASModel.rb', line 529</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_suppressible? fid id'>suppressible?</span>
  <span class='rubyid_@suppressible ivar id'>@suppressible</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="uri_for-instance_method">
  
    - (<tt>Object</tt>) <strong>uri_for</strong>(jsonmodel, id, opts = {}) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


617
618
619</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'backend/app/model/ASModel.rb', line 617</span>

<span class='rubyid_def def kw'>def</span> <span class='rubyid_uri_for identifier id'>uri_for</span><span class='lparen token'>(</span><span class='rubyid_jsonmodel identifier id'>jsonmodel</span><span class='comma token'>,</span> <span class='rubyid_id identifier id'>id</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='rubyid_JSONModel constant id'>JSONModel</span><span class='lparen token'>(</span><span class='rubyid_jsonmodel identifier id'>jsonmodel</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rubyid_uri_for identifier id'>uri_for</span><span class='lparen token'>(</span><span class='rubyid_id identifier id'>id</span><span class='comma token'>,</span> <span class='rubyid_opts identifier id'>opts</span><span class='dot token'>.</span><span class='rubyid_merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:repo_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rubyid_self self kw'>self</span><span class='dot token'>.</span><span class='rubyid_active_repository identifier id'>active_repository</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='rubyid_end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  ArchivesSpace Version 0.3.x Documentation Generated on Mon Mar 18 14:20:52 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.3 (ruby-1.9.3).
</div>
  </body>
</html>