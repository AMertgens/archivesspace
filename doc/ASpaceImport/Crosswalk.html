<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: ASpaceImport::Crosswalk
  
    &mdash; Documentation by YARD 0.8.3
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../alpha_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../ASpaceImport.html" title="ASpaceImport (module)">ASpaceImport</a></span></span>
     &raquo; 
    <span class="title">Crosswalk</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
    <a class="full_list_link" id="schema_list_link"
        href="../schema_list.html">
      Schema List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: ASpaceImport::Crosswalk
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">migrations/lib/crosswalk.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Crosswalk/PropertyMgr.html" title="ASpaceImport::Crosswalk::PropertyMgr (class)">PropertyMgr</a></span>, <span class='object_link'><a href="Crosswalk/PropertyReceiver.html" title="ASpaceImport::Crosswalk::PropertyReceiver (class)">PropertyReceiver</a></span>
    
  
    
  
</p>







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#init-class_method" title="init (class method)">+ (Object) <strong>init</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Module methods and helpers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_receiver-class_method" title="initialize_receiver (class method)">+ (Object) <strong>initialize_receiver</strong>(p, val_type, schema_def, xwalk_def) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>returns a Property Receiver Class for a property of
a JSONModel Class.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mint_id-class_method" title="mint_id (class method)">+ (Object) <strong>mint_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#models-class_method" title="models (class method)">+ (Object) <strong>models</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#property_receivers-class_method" title="property_receivers (class method)">+ (Object) <strong>property_receivers</strong>(model) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Generate receiver classes for each property of a 
json model.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#property_type-class_method" title="property_type (class method)">+ (Object) <strong>property_type</strong>(schema_def) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Classify properties based on JSON schemas.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#regexify_xpath-class_method" title="regexify_xpath (class method)">+ (Object) <strong>regexify_xpath</strong>(xp, offset = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a regex object that is used to match the xpath of a 
parsed node with an xpath definition in the crosswalk.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#walk-class_method" title="walk (class method)">+ (Object) <strong>walk</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#object_for_node-instance_method" title="#object_for_node (instance method)">- (Object) <strong>object_for_node</strong>(*parseargs) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>class method to mix into an importer class.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#tweak_object-instance_method" title="#tweak_object (instance method)">- (Object) <strong>tweak_object</strong>(json, *parseargs) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wrap_model-instance_method" title="#wrap_model (instance method)">- (Object) <strong>wrap_model</strong>(cls) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="init-class_method">
  
    + (<tt>Object</tt>) <strong>init</strong>(opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Module methods and helpers</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 8</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_init'>init</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='ivar'>@models</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@walk</span> <span class='op'>=</span> <span class='const'>Psych</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='comma'>,</span>
                                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>../crosswalks</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:crosswalk</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>.yml</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
                                            
  <span class='ivar'>@regex_cache</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_receiver-class_method">
  
    + (<tt>Object</tt>) <strong>initialize_receiver</strong>(p, val_type, schema_def, xwalk_def) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>returns a Property Receiver Class for a property of
a JSONModel Class</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 228</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_initialize_receiver'>initialize_receiver</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_val_type'>val_type</span><span class='comma'>,</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='comma'>,</span> <span class='id identifier rubyid_xwalk_def'>xwalk_def</span><span class='rparen'>)</span>
  <span class='const'>Class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>PropertyReceiver</span><span class='rparen'>)</span> <span class='kw'>do</span>
    
    <span class='kw'>class</span> <span class='op'>&lt;&lt;</span> <span class='kw'>self</span>
      <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:property</span>
      <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:val_type</span>
      <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:sdef</span>
      <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:xdef</span>
      <span class='id identifier rubyid_attr_reader'>attr_reader</span> <span class='symbol'>:received_jsonmodel_types</span>
    <span class='kw'>end</span>
    
    <span class='ivar'>@property</span> <span class='op'>=</span> <span class='id identifier rubyid_p'>p</span>
    <span class='ivar'>@val_type</span> <span class='op'>=</span> <span class='id identifier rubyid_val_type'>val_type</span>
    <span class='ivar'>@sdef</span> <span class='op'>=</span> <span class='id identifier rubyid_schema_def'>schema_def</span>
    <span class='ivar'>@xdef</span> <span class='op'>=</span> <span class='id identifier rubyid_xwalk_def'>xwalk_def</span>

    <span class='kw'>case</span> <span class='ivar'>@val_type</span> 
      
    <span class='kw'>when</span> <span class='symbol'>:uri</span>
      <span class='ivar'>@received_jsonmodel_types</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@sdef</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:([a-zA-Z_]*)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='symbol'>:array_of_uris_or_objects</span>
      <span class='ivar'>@received_jsonmodel_types</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='ivar'>@sdef</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:([a-zA-Z_]*)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='symbol'>:array_of_objects</span> 
      <span class='kw'>if</span> <span class='ivar'>@sdef</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>Array</span>
        <span class='ivar'>@received_jsonmodel_types</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='ivar'>@sdef</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='ivar'>@received_jsonmodel_types</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_t'>t</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:([a-zA-Z_]*)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mint_id-class_method">
  
    + (<tt>Object</tt>) <strong>mint_id</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 26</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_mint_id'>mint_id</span>
  <span class='ivar'>@counter</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='ivar'>@counter</span> <span class='op'>+=</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="models-class_method">
  
    + (<tt>Object</tt>) <strong>models</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 22</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_models'>models</span>
  <span class='ivar'>@models</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="property_receivers-class_method">
  
    + (<tt>Object</tt>) <strong>property_receivers</strong>(model) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Generate receiver classes for each property of a 
json model</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217
218
219
220
221
222
223</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 215</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_property_receivers'>property_receivers</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_receivers'>receivers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  
  <span class='ivar'>@walk</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>entities</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_record_type'>record_type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>properties</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='id identifier rubyid_defn'>defn</span><span class='op'>|</span>
     <span class='id identifier rubyid_receivers'>receivers</span><span class='lbracket'>[</span><span class='id identifier rubyid_p'>p</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_initialize_receiver'>initialize_receiver</span><span class='lparen'>(</span><span class='id identifier rubyid_p'>p</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_property_type'>property_type</span><span class='lparen'>(</span><span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_schema'>schema</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>properties</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_p'>p</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_model'>model</span><span class='period'>.</span><span class='id identifier rubyid_schema'>schema</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>properties</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_p'>p</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_defn'>defn</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
 
  <span class='id identifier rubyid_receivers'>receivers</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="property_type-class_method">
  
    + (<tt>Object</tt>) <strong>property_type</strong>(schema_def) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Classify properties based on JSON schemas.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 375</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_property_type'>property_type</span><span class='lparen'>(</span><span class='id identifier rubyid_schema_def'>schema_def</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>string</span><span class='tstring_end'>'</span></span>
    <span class='symbol'>:string</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^JSON.*object$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='symbol'>:object</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^JSON.*(uri|uri_or_object)$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='symbol'>:uri</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>array</span><span class='tstring_end'>'</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^JSON.*(uri|uri_or_object)$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
      <span class='symbol'>:array_of_uris_or_objects</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^JSON.*object$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^object$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> 
      <span class='symbol'>:array_of_objects</span>
    <span class='kw'>else</span>
      <span class='symbol'>:array_of_strings</span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>array</span><span class='tstring_end'>'</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_schema_def'>schema_def</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>items</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
    <span class='symbol'>:array_of_objects</span>
  <span class='kw'>else</span>
    <span class='symbol'>:unknown</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="regexify_xpath-class_method">
  
    + (<tt>Object</tt>) <strong>regexify_xpath</strong>(xp, offset = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a regex object that is used to match the xpath of a 
parsed node with an xpath definition in the crosswalk. In the 
case of properties, the offset is the depth of the predicate 
node less the depth of the subject node. An offset of nil
indicates a root perspective.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 37</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_regexify_xpath'>regexify_xpath</span><span class='lparen'>(</span><span class='id identifier rubyid_xp'>xp</span><span class='comma'>,</span> <span class='id identifier rubyid_offset'>offset</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  
  <span class='comment'># Slice the xpath based on the offset
</span>  <span class='comment'># escape for `text()` nodes
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_offset'>offset</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_offset'>offset</span> <span class='op'>&lt;</span> <span class='int'>1</span>
    <span class='id identifier rubyid_xp'>xp</span> <span class='op'>=</span> <span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[^\/]+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='op'>*</span><span class='op'>-</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\(\)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[(]{1}[)]{1}</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='ivar'>@regex_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_xp'>xp</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  
  <span class='kw'>case</span> <span class='id identifier rubyid_offset'>offset</span>
    
  <span class='kw'>when</span> <span class='kw'>nil</span>
    <span class='ivar'>@regex_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_xp'>xp</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>^(/|/</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span> 
                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(child::)?(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_n'>n</span><span class='rbrace'>}</span><span class='tstring_content'>|\\*)</span><span class='tstring_end'>&quot;</span></span> 
                            <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.*\/</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$</span><span class='tstring_end'>&quot;</span></span>
    
  <span class='kw'>when</span> <span class='int'>0</span>
    <span class='ivar'>@regex_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_xp'>xp</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[\/]?</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.*\/</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span>

  <span class='kw'>when</span> <span class='int'>1</span><span class='op'>..</span><span class='int'>100</span>
    <span class='ivar'>@regex_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_xp'>xp</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>^(descendant::|</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[a-zA-Z_]+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='op'>*</span><span class='op'>-</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span> 
                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(child::)?(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_n'>n</span><span class='rbrace'>}</span><span class='tstring_content'>|\\*)</span><span class='tstring_end'>&quot;</span></span> 
                            <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/(child::)?)</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.*\/</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$</span><span class='tstring_end'>&quot;</span></span>

  
  <span class='kw'>when</span> <span class='op'>-</span><span class='int'>100</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span>
    <span class='ivar'>@regex_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_xp'>xp</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>^(ancestor::|</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_offset'>offset</span><span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span><span class='op'>*</span><span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span>
                              <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>parent::\\*/</span><span class='tstring_end'>&quot;</span></span>
                              <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>parent::)</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.*\/</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@regex_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_xp'>xp</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='rbracket'>]</span>
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="walk-class_method">
  
    + (<tt>Object</tt>) <strong>walk</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 18</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_walk'>walk</span>     
  <span class='ivar'>@walk</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="object_for_node-instance_method">
  
    - (<tt>Object</tt>) <strong>object_for_node</strong>(*parseargs) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>class method to mix into an importer class.
analyzes parsing context and returns a new
object, a queued object, or false. also
wraps the object&#8217;s model so that it can pick
up attributes from the parser.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_object_for_node'>object_for_node</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_parseargs'>parseargs</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_xpath'>xpath</span><span class='comma'>,</span> <span class='id identifier rubyid_ndepth'>ndepth</span><span class='comma'>,</span> <span class='id identifier rubyid_ntype'>ntype</span><span class='comma'>,</span> <span class='id identifier rubyid_queue'>queue</span> <span class='op'>=</span> <span class='op'>*</span><span class='id identifier rubyid_parseargs'>parseargs</span>
  <span class='id identifier rubyid_models'>models</span> <span class='op'>=</span> <span class='const'>ASpaceImport</span><span class='op'>::</span><span class='const'>Crosswalk</span><span class='period'>.</span><span class='id identifier rubyid_models'>models</span>
  <span class='id identifier rubyid_walk'>walk</span> <span class='op'>=</span> <span class='const'>ASpaceImport</span><span class='op'>::</span><span class='const'>Crosswalk</span><span class='period'>.</span><span class='id identifier rubyid_walk'>walk</span>
  <span class='id identifier rubyid_regex'>regex</span> <span class='op'>=</span> <span class='const'>ASpaceImport</span><span class='op'>::</span><span class='const'>Crosswalk</span><span class='period'>.</span><span class='id identifier rubyid_regexify_xpath'>regexify_xpath</span><span class='lparen'>(</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_types'>types</span> <span class='op'>=</span> <span class='id identifier rubyid_walk'>walk</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>entities</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_k'>k</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>xpath</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>xpath</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_regex'>regex</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_types'>types</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>

  <span class='kw'>when</span> <span class='int'>2</span><span class='op'>..</span><span class='int'>100</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Too many matched entities</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='int'>1</span> 
    <span class='kw'>if</span> <span class='id identifier rubyid_ntype'>ntype</span> <span class='op'>==</span> <span class='int'>1</span>
      <span class='id identifier rubyid_models'>models</span><span class='lbracket'>[</span><span class='id identifier rubyid_types'>types</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_wrap_model'>wrap_model</span><span class='lparen'>(</span><span class='const'>JSONModel</span><span class='op'>::</span><span class='const'>JSONModel</span><span class='lparen'>(</span><span class='id identifier rubyid_types'>types</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_tweak_object'>tweak_object</span><span class='lparen'>(</span><span class='id identifier rubyid_models'>models</span><span class='lbracket'>[</span><span class='id identifier rubyid_types'>types</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_parseargs'>parseargs</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_queue'>queue</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Record Type mismatch in parse queue</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_queue'>queue</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_record_type'>record_type</span> <span class='op'>==</span> <span class='id identifier rubyid_types'>types</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_queue'>queue</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='int'>0</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="tweak_object-instance_method">
  
    - (<tt>Object</tt>) <strong>tweak_object</strong>(json, *parseargs) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


152
153
154
155
156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 152</span>

<span class='kw'>def</span> <span class='id identifier rubyid_tweak_object'>tweak_object</span><span class='lparen'>(</span><span class='id identifier rubyid_json'>json</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_parseargs'>parseargs</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_json'>json</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='comma'>,</span> <span class='id identifier rubyid_json'>json</span><span class='period'>.</span><span class='id identifier rubyid_depth'>depth</span> <span class='op'>=</span> <span class='op'>*</span><span class='id identifier rubyid_parseargs'>parseargs</span>

  <span class='comment'># Set a pre-save URI to be dereferenced by the backend
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_json'>json</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_method_defined?'>method_defined?</span> <span class='symbol'>:uri</span>
    <span class='id identifier rubyid_json'>json</span><span class='period'>.</span><span class='id identifier rubyid_uri'>uri</span> <span class='op'>=</span> <span class='id identifier rubyid_json'>json</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_uri_for'>uri_for</span><span class='lparen'>(</span><span class='const'>ASpaceImport</span><span class='op'>::</span><span class='const'>Crosswalk</span><span class='period'>.</span><span class='id identifier rubyid_mint_id'>mint_id</span><span class='rparen'>)</span> 
  <span class='kw'>end</span>
  
  <span class='id identifier rubyid_json'>json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wrap_model-instance_method">
  
    - (<tt>Object</tt>) <strong>wrap_model</strong>(cls) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 104</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wrap_model'>wrap_model</span><span class='lparen'>(</span><span class='id identifier rubyid_cls'>cls</span><span class='rparen'>)</span>
  
  <span class='id identifier rubyid_cls'>cls</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>
    
    <span class='ivar'>@receivers</span> <span class='op'>=</span> <span class='const'>ASpaceImport</span><span class='op'>::</span><span class='const'>Crosswalk</span><span class='period'>.</span><span class='id identifier rubyid_property_receivers'>property_receivers</span><span class='lparen'>(</span><span class='id identifier rubyid_cls'>cls</span><span class='rparen'>)</span>
    
    <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_receivers'>receivers</span>
      <span class='ivar'>@receivers</span>
    <span class='kw'>end</span>
         
    <span class='kw'>def</span> <span class='id identifier rubyid_receivers'>receivers</span>
      <span class='ivar'>@property_mgr</span> <span class='op'>||=</span> <span class='const'>ASpaceImport</span><span class='op'>::</span><span class='const'>Crosswalk</span><span class='op'>::</span><span class='const'>PropertyMgr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
      <span class='ivar'>@property_mgr</span>
    <span class='kw'>end</span>
             
    <span class='kw'>def</span> <span class='id identifier rubyid_set_default_properties'>set_default_properties</span>
      <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_receivers'>receivers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_receive'>receive</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    
    <span class='kw'>def</span> <span class='id identifier rubyid_tmp_vals'>tmp_vals</span>
      <span class='ivar'>@tmp_vals</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='kw'>end</span>
          
    <span class='kw'>def</span> <span class='id identifier rubyid_depth'>depth</span>
      <span class='ivar'>@depth</span> <span class='op'>||=</span> <span class='int'>0</span>
    <span class='kw'>end</span>
    
    <span class='kw'>def</span> <span class='id identifier rubyid_xpath'>xpath</span>
      <span class='ivar'>@xpath</span> <span class='op'>||=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    
    <span class='kw'>def</span> <span class='id identifier rubyid_block_further_reception'>block_further_reception</span>
      <span class='ivar'>@done_being_received</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id identifier rubyid_done_being_received?'>done_being_received?</span>
      <span class='ivar'>@done_being_received</span> <span class='op'>||=</span> <span class='kw'>false</span>
      <span class='ivar'>@done_being_received</span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:depth</span>
    <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:xpath</span>
    
  <span class='kw'>end</span>

  <span class='id identifier rubyid_cls'>cls</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  ArchivesSpace Version 0.1.x Documentation Generated on Fri Dec  7 09:55:51 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.3 (ruby-1.9.3).
</div>
  </body>
</html>