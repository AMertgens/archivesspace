<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: ASpaceImport::Crosswalk
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../ASpaceImport.html" title="ASpaceImport (module)">ASpaceImport</a></span></span>
     &raquo; 
    <span class="title">Crosswalk</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
    <a class="full_list_link" id="schema_list_link"
        href="../schema_list.html">
      Schema List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: ASpaceImport::Crosswalk
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">migrations/lib/crosswalk.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Crosswalk/PropertyMgr.html" title="ASpaceImport::Crosswalk::PropertyMgr (class)">PropertyMgr</a></span>, <span class='object_link'><a href="Crosswalk/PropertyReceiver.html" title="ASpaceImport::Crosswalk::PropertyReceiver (class)">PropertyReceiver</a></span>
    
  
    
  
</p>







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#init-class_method" title="init (class method)">+ (Object) <strong>init</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#lookup-class_method" title="lookup (class method)">+ (Object) <strong>lookup</strong>(xpath) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Hash lookup for record types in the crosswalk that match an xpath.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#regexify_node-class_method" title="regexify_node (class method)">+ (Object) <strong>regexify_node</strong>(node_name, depth_offset = 0) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a regex object that will be used to determine if a parsing
context is relevant to a JSON object in the queue.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#walk-class_method" title="walk (class method)">+ (Object) <strong>walk</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#target_objects-instance_method" title="#target_objects (instance method)">- (Object) <strong>target_objects</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Given an xpath, return true if the crosswalk maps it to a JSON
Model.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="init-class_method">
  
    + (<tt>Object</tt>) <strong>init</strong>(opts) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


6
7
8
9
10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 6</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_init'>init</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='cvar'>@@walk</span> <span class='op'>=</span> <span class='const'>Psych</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span><span class='comma'>,</span>
                                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>../crosswalks</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:crosswalk</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>.yml</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
                                                  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="lookup-class_method">
  
    + (<tt>Object</tt>) <strong>lookup</strong>(xpath) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Hash lookup for record types in the crosswalk that match an xpath</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 45</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lookup'>lookup</span><span class='lparen'>(</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rparen'>)</span>
  
  <span class='cvar'>@@types_lookup</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  
  <span class='kw'>unless</span> <span class='cvar'>@@types_lookup</span><span class='lbracket'>[</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rbracket'>]</span>
    
    <span class='id identifier rubyid_types'>types</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    
    <span class='cvar'>@@walk</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>entities</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ent'>ent</span><span class='comma'>,</span> <span class='id identifier rubyid_defn'>defn</span><span class='op'>|</span>
      <span class='id identifier rubyid_defn'>defn</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>xpath</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_xp'>xp</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(\/)*</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_types'>types</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_ent'>ent</span><span class='rparen'>)</span> 
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_types'>types</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='cvar'>@@types_lookup</span><span class='lbracket'>[</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_types'>types</span>
    <span class='kw'>else</span>
      <span class='cvar'>@@types_lookup</span><span class='lbracket'>[</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>  

  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Lookup for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rbrace'>}</span><span class='tstring_content'> returns </span><span class='embexpr_beg'>#{</span><span class='cvar'>@@types_lookup</span><span class='lbracket'>[</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$DEBUG</span>

  <span class='kw'>return</span> <span class='cvar'>@@types_lookup</span><span class='lbracket'>[</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rbracket'>]</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="regexify_node-class_method">
  
    + (<tt>Object</tt>) <strong>regexify_node</strong>(node_name, depth_offset = 0) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a regex object that will be used to determine if a parsing
context is relevant to a JSON object in the queue.  The depth offset
is the node.depth of the parsing context that created the JSON
object, less the node.depth of the current parsing context.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 24</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_regexify_node'>regexify_node</span><span class='lparen'>(</span><span class='id identifier rubyid_node_name'>node_name</span><span class='comma'>,</span> <span class='id identifier rubyid_depth_offset'>depth_offset</span> <span class='op'>=</span> <span class='int'>0</span><span class='rparen'>)</span>
  
  <span class='kw'>case</span> <span class='id identifier rubyid_depth_offset'>depth_offset</span>
    
  <span class='kw'>when</span> <span class='op'>-</span><span class='int'>100</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span>
    <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^ancestor::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_name'>node_name</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span>
  <span class='kw'>when</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(parent|ancestor)::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_name'>node_name</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span>          
  <span class='kw'>when</span> <span class='int'>0</span>
    <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_name'>node_name</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span>
  <span class='kw'>when</span> <span class='int'>1</span>
    <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(child|descendant)::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_name'>node_name</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span>
  <span class='kw'>when</span> <span class='int'>2</span>
    <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(child::\*\/child|descendant)::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_name'>node_name</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span>
  <span class='kw'>when</span> <span class='int'>3</span><span class='op'>..</span><span class='int'>100</span>
    <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^descendant::</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_node_name'>node_name</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="walk-class_method">
  
    + (<tt>Object</tt>) <strong>walk</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


14
15
16
17</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 14</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_walk'>walk</span>
  
  <span class='cvar'>@@walk</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="target_objects-instance_method">
  
    - (<tt>Object</tt>) <strong>target_objects</strong>(opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Given an xpath, return true if the crosswalk maps it to a JSON
Model. Return a JSONModel for any match if given a block Example:</p>

<p>Crosswalk.target_objects(:xpath =&gt; &#8216;c&#8217;)
    =&gt; true</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'migrations/lib/crosswalk.rb', line 79</span>

<span class='kw'>def</span> <span class='id identifier rubyid_target_objects'>target_objects</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  
  <span class='cvar'>@@entity_map</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='int'>0</span>
  
  <span class='kw'>unless</span> <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    
    <span class='cvar'>@@walk</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>entities</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ent'>ent</span><span class='comma'>,</span> <span class='id identifier rubyid_defn'>defn</span><span class='op'>|</span>

      <span class='id identifier rubyid_defn'>defn</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>xpath</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_xp'>xp</span><span class='op'>|</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_xp'>xp</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(\/)*</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
          
          <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Matched </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xp'>xp</span><span class='rbrace'>}</span><span class='tstring_content'> using </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$DEBUG</span>
          
          <span class='kw'>if</span> <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'>StandardError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Found more than one entity to create with </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_xpath'>xpath</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>end</span>
          
          <span class='id identifier rubyid_mod'>mod</span> <span class='op'>=</span> <span class='const'>JSONModel</span><span class='op'>::</span><span class='const'>JSONModel</span><span class='lparen'>(</span><span class='id identifier rubyid_ent'>ent</span><span class='rparen'>)</span>
          
          <span class='id identifier rubyid_mod'>mod</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span> <span class='kw'>do</span>
            
            <span class='id identifier rubyid_include'>include</span> <span class='const'>JSONModel</span><span class='op'>::</span><span class='const'>Queueable</span>
            
            <span class='kw'>def</span> <span class='id identifier rubyid_receivers'>receivers</span>
              <span class='kw'>unless</span> <span class='ivar'>@property_mgr</span>
                <span class='ivar'>@property_mgr</span> <span class='op'>=</span> <span class='const'>ASpaceImport</span><span class='op'>::</span><span class='const'>Crosswalk</span><span class='op'>::</span><span class='const'>PropertyMgr</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
              <span class='kw'>end</span>
              
              <span class='ivar'>@property_mgr</span>
            <span class='kw'>end</span>
          
            <span class='kw'>def</span> <span class='id identifier rubyid_mapped_properties'>mapped_properties</span>
              <span class='const'>ASpaceImport</span><span class='op'>::</span><span class='const'>Crosswalk</span><span class='op'>::</span><span class='id identifier rubyid_walk'>walk</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>entities</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_record_type'>record_type</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>properties</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
            <span class='kw'>end</span>
                     
            <span class='kw'>def</span> <span class='id identifier rubyid_set_default_properties'>set_default_properties</span>
              <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_receivers'>receivers</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='period'>.</span><span class='id identifier rubyid_receive'>receive</span> <span class='rbrace'>}</span>
            <span class='kw'>end</span>
            
          <span class='kw'>end</span>                
          
          <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Trying to reset a key in @@entity_map</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='gvar'>$DEBUG</span> 
            
          <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_mod'>mod</span>

        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='id identifier rubyid_obj'>obj</span> <span class='op'>=</span> <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:depth</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_instance_eval'>instance_eval</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>def depth; </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:depth</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>; end</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    
    <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_after_save'>after_save</span> <span class='lbrace'>{</span> <span class='ivar'>@goodimports</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_after_save'>after_save</span> <span class='lbrace'>{</span> <span class='ivar'>@import_log</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Imported </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_obj'>obj</span><span class='period'>.</span><span class='id identifier rubyid_uri'>uri</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    
    <span class='kw'>yield</span> <span class='id identifier rubyid_obj'>obj</span>
    
  <span class='kw'>elsif</span> <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>XP: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> -- EM: </span><span class='embexpr_beg'>#{</span><span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='gvar'>$DEBUG</span>
    <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='cvar'>@@entity_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:xpath</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  ArchivesSpace Version 0.1.x Documentation Generated on Mon Oct 15 10:20:23 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.9.3).
</div>
  </body>
</html>